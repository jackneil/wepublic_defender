#!/bin/bash
# SessionStart hook: Auto-run session checklist when Claude Code opens
#
# This hook fires when:
# - User opens Claude Code (source: "startup")
# - Session resumes after compacting (source: "resume")
# - Session cleared (source: "clear")
#
# Payload provides: source, session_id, parent_session_id (if forked)

# Output instructions to stderr (exit code 2 shows to user without blocking)
cat >&2 <<'EOF'
[SESSION START - Auto-loading case context]

## CRITICAL: File Editing on Windows

**MANDATORY: Always Use Backslashes on Windows for File Paths**

When using Edit or MultiEdit tools on Windows, you MUST use backslashes (\) in file paths, NOT forward slashes (/).

WRONG - Will cause errors:
Edit(file_path: "D:/repos/project/file.tsx", ...)

CORRECT - Always works:
Edit(file_path: "D:\\repos\\project\\file.tsx", ...)

This is a known bug in Claude Code - Edit/MultiEdit require backslashes on Windows even though Bash commands use forward slashes.

---

Immediately follow `.claude/workflows/session_start_checklist.md`:

1. Load context from:
   - `.wepublic_defender/session_notes.md` (last session work)
   - `.wepublic_defender/case_timeline.md` (recent events)
   - `GAMEPLAN.md` (strategy and deadlines)

2. Check `00_NEW_DOCUMENTS_INBOX/` for new files to organize

3. Identify upcoming deadlines (next 7 days from GAMEPLAN)

4. Detect case stage using these indicators:
   - PRE-FILING: No 02_PLEADINGS/01_Complaint/ folder
   - DISCOVERY: 03_DISCOVERY/ has recent files
   - MOTION PRACTICE: 02_PLEADINGS/03_Motions/ has recent activity
   - TRIAL PREP: case_timeline mentions "trial scheduled"

5. Present stage-appropriate multiple choice questions (1-6 options)

Execute checklist NOW before responding to user's first message.
EOF

# Exit with code 2 to show message to user without blocking
exit 2
